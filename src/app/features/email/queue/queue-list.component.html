<div class="p-10 min-h-screen bg-background">
  <div class="max-w-[1400px] mx-auto">
    <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold tracking-tight text-foreground">Email Queue</h1>
      <p class="text-muted-foreground mt-1">Manage pending and failed email deliveries</p>
    </div>
    <button (click)="loadQueue()" class="btn-outline btn-sm flex items-center gap-2" [disabled]="loading">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" [class.animate-spin]="loading">
        <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
        <path d="M21 3v5h-5"/>
      </svg>
      Refresh
    </button>
  </div>

  <div class="card overflow-hidden">
    @if (loading && items.length === 0) {
      <div class="p-12 space-y-4">
        @for (i of [1,2,3,4,5]; track i) {
          <div class="skeleton h-12 w-full"></div>
        }
      </div>
    }

    @if (!loading && items.length === 0) {
      <div class="text-center py-20 bg-muted/10">
        <div class="flex justify-center mb-4 text-muted-foreground/50">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect width="20" height="16" x="2" y="4" rx="2"/>
            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-foreground">Queue is empty</h3>
        <p class="text-muted-foreground">All messages have been processed or the queue is clear.</p>
      </div>
    }

    @if (items.length > 0) {
      <div class="overflow-x-auto">
        <table class="table">
          <thead class="table-header">
            <tr>
              <th class="table-head w-[100px]">UID</th>
              <th class="table-head">Mailbox</th>
              <th class="table-head">Protocol</th>
              <th class="table-head">Retries</th>
              <th class="table-head">Created</th>
              <th class="table-head text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="table-body">
            @for (item of items; track item.uid) {
              <tr class="table-row">
                <td class="table-cell font-mono text-xs text-muted-foreground">
                  {{ item.uid | slice:0:8 }}
                </td>
                <td class="table-cell font-medium">
                  {{ item.mailbox }}
                </td>
                <td class="table-cell">
                  <span class="badge-secondary px-2 py-0.5 text-[10px] uppercase tracking-wider">
                    {{ item.protocol }}
                  </span>
                </td>
                <td class="table-cell">
                  <div class="flex items-center gap-2">
                    <span class="text-sm">{{ item.retryCount }} / {{ item.maxRetryCount }}</span>
                    @if (item.retryCount > 0) {
                      <div class="progress h-1.5 w-12">
                        <div class="progress-indicator" [style.width.%]="(item.retryCount / item.maxRetryCount) * 100"></div>
                      </div>
                    }
                  </div>
                </td>
                <td class="table-cell text-muted-foreground">
                  {{ item.createTime | relativeTime }}
                </td>
                <td class="table-cell text-right space-x-2">
                  <button
                    (click)="retryItem(item)"
                    class="btn-ghost btn-sm text-primary hover:text-primary hover:bg-primary/10"
                    title="Retry Delivery"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                      <path d="M3 3v5h5"/>
                    </svg>
                  </button>
                  <button
                    (click)="deleteItem(item)"
                    class="btn-ghost btn-sm text-destructive hover:text-destructive hover:bg-destructive/10"
                    title="Delete Item"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
      <div class="px-6 py-4 flex items-center justify-between border-t border-border bg-muted/5">
        <div class="text-xs text-muted-foreground font-medium">
          Showing <span class="text-foreground">{{ currentPage * pageSize + 1 }}</span> to
          <span class="text-foreground">{{ Math.min((currentPage + 1) * pageSize, totalCount) }}</span> of
          <span class="text-foreground">{{ totalCount }}</span> entries
        </div>
        <div class="flex items-center gap-2">
          <button
            (click)="previousPage()"
            [disabled]="currentPage === 0"
            class="btn-outline btn-sm"
          >
            Previous
          </button>
          <button
            (click)="nextPage()"
            [disabled]="(currentPage + 1) * pageSize >= totalCount"
            class="btn-outline btn-sm"
          >
            Next
          </button>
        </div>
      </div>
    }
  </div>
</div>


