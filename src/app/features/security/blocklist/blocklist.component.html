<div class="p-10 min-h-screen bg-background">
  <div class="max-w-[1400px] mx-auto space-y-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
      <div>
        <h1 class="text-3xl font-bold tracking-tight text-foreground">IP/Domain Blocklist</h1>
        <p class="text-muted-foreground mt-1">Protect your server by blocking known malicious IPs, CIDR ranges, and domains</p>
      </div>

      <div class="flex items-center gap-3">
        <div class="flex items-center bg-muted/20 border border-border rounded-lg p-1">
          <button (click)="exportBlocklist('csv')" class="btn-ghost btn-sm text-[10px] font-bold uppercase tracking-widest px-3">CSV</button>
          <div class="w-[1px] h-4 bg-border"></div>
          <button (click)="exportBlocklist('json')" class="btn-ghost btn-sm text-[10px] font-bold uppercase tracking-widest px-3">JSON</button>
        </div>

        <button (click)="fileInput.click()" class="btn-outline btn-sm flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
          Import
        </button>
        <input #fileInput type="file" accept=".csv,.json" (change)="onFileSelected($event)" hidden />

        <button (click)="toggleAddForm()" class="btn-primary btn-sm flex items-center gap-2 px-6">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            @if (showAddForm) {
              <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            } @else {
              <path d="M12 5v14"/><path d="M5 12h14"/>
            }
          </svg>
          {{ showAddForm ? 'Cancel' : 'Add Entry' }}
        </button>
      </div>
    </div>

    <!-- Add Entry Form -->
    @if (showAddForm) {
      <div class="card overflow-hidden animate-slide-in-from-top">
        <div class="card-header border-b border-border/50 bg-muted/5">
          <h3 class="card-title text-lg">Add Blocklist Entry</h3>
          <p class="card-description">Create a new rule to block traffic from a specific source</p>
        </div>
        <div class="card-content pt-6">
          <form [formGroup]="entryForm" (ngSubmit)="addEntry()" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
              <div class="space-y-2">
                <label class="text-xs font-bold uppercase tracking-widest text-muted-foreground">Entry Type</label>
                <select formControlName="type" class="input bg-background appearance-none">
                  @for (type of entryTypes; track type) {
                    <option [value]="type">{{ type }}</option>
                  }
                </select>
              </div>

              <div class="md:col-span-3 space-y-2">
                <label class="text-xs font-bold uppercase tracking-widest text-muted-foreground">Value (IP / CIDR / Domain)</label>
                <div class="relative">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="absolute left-3 top-3 text-muted-foreground">
                    <circle cx="12" cy="12" r="10"/><path d="M4.93 4.93l14.14 14.14"/>
                  </svg>
                  <input type="text" formControlName="value" class="input pl-10" [placeholder]="getPlaceholder()" />
                </div>
              </div>
            </div>

            <div class="space-y-2">
              <label class="text-xs font-bold uppercase tracking-widest text-muted-foreground">Reason for Blocking</label>
              <textarea formControlName="reason" rows="2" class="input min-h-[80px] py-3" placeholder="e.g., Identified as persistent spam source from region X"></textarea>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-2">
                <label class="text-xs font-bold uppercase tracking-widest text-muted-foreground">Expiration Date</label>
                <input type="datetime-local" formControlName="expiresAt" class="input" />
                <p class="text-[10px] text-muted-foreground">Leave empty for a permanent block</p>
              </div>

              <div class="flex items-center justify-between p-4 bg-muted/30 rounded-xl border border-border">
                <div class="flex items-center gap-3">
                  <div class="p-2 rounded-lg bg-background border border-border text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                  </div>
                  <div>
                    <h4 class="text-sm font-bold">Activate Immediately</h4>
                    <p class="text-[11px] text-muted-foreground leading-none">Apply this rule to traffic as soon as it's saved</p>
                  </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" formControlName="active" class="sr-only peer">
                  <div class="w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-ring rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                </label>
              </div>
            </div>

            <div class="flex justify-end pt-4 border-t border-border/50">
              <button type="submit" [disabled]="entryForm.invalid" class="btn-primary px-8 h-11 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
                </svg>
                Save Entry
              </button>
            </div>
          </form>
        </div>
      </div>
    }

    <!-- Content Area -->
    <div class="space-y-4">
      <!-- Filter Bar -->
      <div class="flex flex-col md:flex-row md:items-center gap-4 bg-card border border-border p-4 rounded-xl shadow-sm">
        <div class="flex-1 relative">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="absolute left-3 top-3 text-muted-foreground">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
          </svg>
          <input type="text" placeholder="Search by value or reason..." class="input pl-10 bg-muted/20" />
        </div>

        <div class="flex items-center gap-4">
          <select [(ngModel)]="filterType" (change)="applyFilters()" class="input w-[140px] bg-muted/20">
            <option value="">All Types</option>
            @for (type of entryTypes; track type) {
              <option [value]="type">{{ type }}</option>
            }
          </select>

          <select [(ngModel)]="filterActive" (change)="applyFilters()" class="input w-[160px] bg-muted/20">
            <option [ngValue]="null">All Statuses</option>
            <option [ngValue]="true">Active Only</option>
            <option [ngValue]="false">Inactive Only</option>
          </select>

          <button (click)="clearFilters()" class="btn-ghost btn-sm text-muted-foreground hover:text-foreground">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Table Card -->
      <div class="card overflow-hidden">
        <div class="overflow-x-auto">
          <table class="table">
            <thead class="table-header">
              <tr>
                <th class="table-head">Source Info</th>
                <th class="table-head">Value</th>
                <th class="table-head">Reason</th>
                <th class="table-head">Status</th>
                <th class="table-head text-right">Actions</th>
              </tr>
            </thead>
            <tbody class="table-body">
              @if (loading) {
                @for (i of [1,2,3,4,5]; track i) {
                  <tr class="table-row">
                    <td colspan="5" class="p-0"><div class="skeleton h-14 w-full opacity-20"></div></td>
                  </tr>
                }
              }

              @if (!loading && entries.length === 0) {
                <tr class="table-row">
                  <td colspan="5" class="table-cell py-24 text-center">
                    <div class="flex flex-col items-center justify-center space-y-3 text-muted-foreground">
                      <div class="p-4 rounded-full bg-muted/50 text-muted-foreground/30">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                          <circle cx="12" cy="12" r="10"/><path d="M4.93 4.93l14.14 14.14"/>
                        </svg>
                      </div>
                      <h3 class="text-lg font-bold text-foreground">No entries found</h3>
                      <p class="text-sm max-w-xs mx-auto">Your blocklist is currently empty. Add entries to protect your server.</p>
                      <button (click)="toggleAddForm()" class="btn-outline btn-sm mt-2">Create First Entry</button>
                    </div>
                  </td>
                </tr>
              }

              @for (entry of entries; track entry.id) {
                <tr class="table-row group">
                  <td class="table-cell">
                    <div class="flex items-center gap-3">
                      <div [class]="'p-2 rounded-lg ' + (entry.type === 'DOMAIN' ? 'bg-green-100 text-green-700' : entry.type === 'CIDR' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                          @if (entry.type === 'IP') { <path d="M12 20h.01"/><path d="M2 15a10 10 0 0 1 20 0"/><path d="M2 20h.01"/><path d="M22 20h.01"/><path d="M7 20h.01"/><path d="M17 20h.01"/><path d="M5 20a7 7 0 1 1 14 0"/> }
                          @if (entry.type === 'CIDR') { <rect width="18" height="18" x="3" y="3" rx="2"/><path d="M9 12h6"/><path d="M12 9v6"/> }
                          @if (entry.type === 'DOMAIN') { <circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/> }
                        </svg>
                      </div>
                      <div>
                        <div class="text-sm font-bold text-foreground leading-none mb-1">{{ entry.type }}</div>
                        <div class="text-[10px] text-muted-foreground uppercase font-bold tracking-tighter">Created {{ formatDate(entry.createdAt) }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="table-cell">
                    <code class="px-2 py-0.5 rounded bg-muted text-[11px] font-mono font-bold text-foreground border border-border/50">{{ entry.value }}</code>
                  </td>
                  <td class="table-cell">
                    <div class="max-w-[300px] truncate text-xs text-muted-foreground font-medium" [title]="entry.reason">
                      {{ entry.reason }}
                    </div>
                  </td>
                  <td class="table-cell">
                    <div class="flex flex-col gap-1">
                      <app-status-badge
                        [status]="entry.active ? 'active' : 'inactive'"
                        [label]="entry.active ? 'ACTIVE' : 'PAUSED'"
                        size="sm"
                      ></app-status-badge>
                      @if (entry.expiresAt) {
                        <div [class]="'text-[9px] font-bold flex items-center gap-1 mt-1 ' + (isExpired(entry) ? 'text-destructive' : 'text-muted-foreground')">
                          <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                          </svg>
                          {{ isExpired(entry) ? 'EXPIRED' : 'EXPIRES ' + formatDate(entry.expiresAt) }}
                        </div>
                      }
                    </div>
                  </td>
                  <td class="table-cell text-right">
                    <div class="flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                      <button (click)="toggleActive(entry)" class="btn-ghost btn-icon h-8 w-8 text-muted-foreground hover:text-primary" [title]="entry.active ? 'Deactivate' : 'Activate'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          @if (entry.active) { <circle cx="12" cy="12" r="10"/><line x1="10" y1="15" x2="10" y2="9"/><line x1="14" y1="15" x2="14" y2="9"/> }
                          @else { <path d="m9 18 6-6-6-6"/> }
                        </svg>
                      </button>
                      <button (click)="deleteEntry(entry)" class="btn-ghost btn-icon h-8 w-8 text-destructive hover:bg-destructive/10" title="Delete Entry">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Pagination Bar -->
        <div class="px-6 py-4 flex items-center justify-between border-t border-border bg-muted/5">
          <div class="text-[11px] text-muted-foreground font-bold uppercase tracking-widest">
            Total Entries: <span class="text-foreground ml-1">{{ totalEntries }}</span>
          </div>
          <div class="flex items-center gap-2">
            <button
              (click)="previousPage()"
              [disabled]="currentPage === 0"
              class="btn-outline btn-sm h-8 px-3 text-[10px] font-bold uppercase"
            >
              Previous
            </button>
            <div class="flex items-center gap-1 px-3">
              <span class="text-[11px] font-bold text-foreground">{{ currentPage + 1 }}</span>
              <span class="text-[11px] text-muted-foreground">/</span>
              <span class="text-[11px] font-bold text-muted-foreground">{{ Math.ceil(totalEntries / pageSize) || 1 }}</span>
            </div>
            <button
              (click)="nextPage()"
              [disabled]="(currentPage + 1) * pageSize >= totalEntries"
              class="btn-outline btn-sm h-8 px-3 text-[10px] font-bold uppercase"
            >
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
