<div class="p-10 min-h-screen bg-background">
  <div class="max-w-[1400px] mx-auto space-y-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold tracking-tight text-foreground">ClamAV Configuration</h1>
      <p class="text-muted-foreground mt-1">Configure antivirus scanning for incoming email traffic</p>
    </div>

    <!-- Status Badge -->
    @if (status) {
      <div class="flex items-center gap-3 bg-card border border-border px-4 py-2 rounded-xl shadow-sm">
        <div [class]="'p-2 rounded-full ' + (status.status === 'UP' ? 'bg-accent/10 text-accent' : 'bg-destructive/10 text-destructive')">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            @if (status.status === 'UP') {
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
            } @else {
              <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
            }
          </svg>
        </div>
        <div>
          <div class="text-xs font-bold uppercase tracking-wider text-muted-foreground leading-none mb-1">Service Status</div>
          <div class="text-sm font-bold flex items-center gap-2">
            <span [class]="status.status === 'UP' ? 'text-accent' : 'text-destructive'">{{ status.status }}</span>
            @if (status.version && status.version !== 'unknown') {
              <span class="text-muted-foreground font-normal text-xs border-l border-border pl-2">{{ status.version }}</span>
            }
          </div>
        </div>
      </div>
    }
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Configuration Form -->
    <div class="lg:col-span-2 space-y-6">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title text-lg">Scanner Settings</h3>
          <p class="card-description">Configure how the MTA connects to the ClamAV daemon</p>
        </div>
        <div class="card-content">
          <form [formGroup]="configForm" (ngSubmit)="saveConfiguration()" class="space-y-6">
            <!-- Loading Skeleton -->
            @if (loading) {
              <div class="space-y-6">
                <div class="skeleton h-16 w-full"></div>
                <div class="grid grid-cols-2 gap-4">
                  <div class="skeleton h-12 w-full"></div>
                  <div class="skeleton h-12 w-full"></div>
                </div>
                <div class="skeleton h-32 w-full"></div>
              </div>
            }

            <!-- Form Fields -->
            @if (!loading) {
              <div class="space-y-8">
                <!-- Enable/Disable Toggle -->
                <div class="flex items-center justify-between p-4 bg-muted/30 rounded-lg border border-border group hover:border-primary/30 transition-colors">
                  <div class="flex items-start gap-3">
                    <div class="p-2 rounded-md bg-background border border-border mt-0.5">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-primary">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-bold text-foreground group-hover:text-primary transition-colors">Antivirus Scanning</h4>
                      <p class="text-sm text-muted-foreground">Scan incoming emails for viruses and malware</p>
                    </div>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" formControlName="enabled" class="sr-only peer">
                    <div class="w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-ring rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                  </label>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="space-y-2">
                    <label class="text-sm font-bold text-foreground">ClamAV Host</label>
                    <div class="relative">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="absolute left-3 top-3 text-muted-foreground">
                        <rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/>
                      </svg>
                      <input type="text" formControlName="host" class="input pl-10" placeholder="localhost" />
                    </div>
                    <p class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Hostname or IP address</p>
                  </div>

                  <div class="space-y-2">
                    <label class="text-sm font-bold text-foreground">Port</label>
                    <div class="relative">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="absolute left-3 top-3 text-muted-foreground">
                        <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                      </svg>
                      <input type="number" formControlName="port" class="input pl-10" placeholder="3310" />
                    </div>
                    <p class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Standard port is 3310</p>
                  </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="space-y-2">
                    <label class="text-sm font-bold text-foreground">Timeout (ms)</label>
                    <div class="relative">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="absolute left-3 top-3 text-muted-foreground">
                        <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                      </svg>
                      <input type="number" formControlName="timeout" class="input pl-10" placeholder="30000" />
                    </div>
                    <p class="text-[11px] text-muted-foreground uppercase tracking-wider font-semibold">Max connection wait time</p>
                  </div>

                  <div class="space-y-2">
                    <label class="text-sm font-bold text-foreground">Max File Size</label>
                    <div class="relative">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="absolute left-3 top-3 text-muted-foreground">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
                      </svg>
                      <input type="number" formControlName="maxFileSize" class="input pl-10" placeholder="26214400" />
                    </div>
                    <p class="text-[11px] text-primary uppercase tracking-wider font-bold">
                      {{ formatBytes(configForm.get('maxFileSize')?.value) }} limit
                    </p>
                  </div>
                </div>

                <div class="space-y-4 pt-4">
                  <div class="flex items-center gap-2 mb-2">
                    <h4 class="text-xs font-bold uppercase tracking-widest text-muted-foreground">Advanced Options</h4>
                    <div class="h-[1px] flex-1 bg-border"></div>
                  </div>

                  <div class="flex items-center justify-between p-3 bg-muted/10 rounded-lg">
                    <div class="flex items-center gap-3">
                      <div class="p-1.5 rounded bg-muted">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-muted-foreground">
                          <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/>
                        </svg>
                      </div>
                      <span class="text-sm font-medium">Scan compressed archives (ZIP, TAR, etc.)</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" formControlName="scanArchives" class="sr-only peer">
                      <div class="w-9 h-5 bg-muted peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-ring rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"></div>
                    </label>
                  </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center justify-between pt-8 border-t border-border">
                  <button
                    type="button"
                    (click)="testConnection()"
                    [disabled]="testing || configForm.invalid"
                    class="btn-outline flex items-center gap-2 px-6 h-11"
                  >
                    @if (testing) {
                      <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      Testing...
                    } @else {
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
                      </svg>
                      Test Connection
                    }
                  </button>

                  <div class="flex items-center gap-3">
                    <button
                      type="button"
                      (click)="resetForm()"
                      [disabled]="saving || loading"
                      class="btn-ghost font-bold uppercase tracking-widest text-[10px]"
                    >
                      Reset Changes
                    </button>
                    <button
                      type="submit"
                      [disabled]="saving || configForm.invalid || configForm.pristine"
                      class="btn-primary flex items-center gap-2 px-8 h-11"
                    >
                      @if (saving) {
                        <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Saving...
                      } @else {
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
                        </svg>
                        Update Configuration
                      }
                    </button>
                  </div>
                </div>
              </div>
            }
          </form>
        </div>
      </div>
    </div>

    <!-- Side Panel -->
    <div class="space-y-6">
      <!-- Information Card -->
      <div class="card bg-primary/[0.02] border-primary/10">
        <div class="card-header border-b border-primary/10 pb-4">
          <div class="flex items-center gap-2">
            <div class="p-1.5 rounded-md bg-primary/10 text-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
              </svg>
            </div>
            <h3 class="card-title text-base font-bold text-primary">About ClamAV</h3>
          </div>
        </div>
        <div class="card-content pt-4">
          <div class="prose prose-sm prose-slate dark:prose-invert">
            <p class="text-muted-foreground leading-relaxed">
              ClamAV is a high-performance antivirus engine designed for mail gateway scanning. It detects trojans, viruses, and malware in real-time.
            </p>
            <h4 class="text-xs font-bold uppercase tracking-widest text-foreground mt-6 mb-3">Quick Setup</h4>
            <ul class="list-none p-0 space-y-3">
              <li class="flex gap-3 text-sm">
                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-primary/10 text-primary text-[10px] font-bold flex items-center justify-center border border-primary/20">1</span>
                <span>Install <code class="bg-muted px-1 rounded text-primary">clamav-daemon</code></span>
              </li>
              <li class="flex gap-3 text-sm">
                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-primary/10 text-primary text-[10px] font-bold flex items-center justify-center border border-primary/20">2</span>
                <span>Run <code class="bg-muted px-1 rounded text-primary">freshclam</code> for updates</span>
              </li>
              <li class="flex gap-3 text-sm">
                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-primary/10 text-primary text-[10px] font-bold flex items-center justify-center border border-primary/20">3</span>
                <span>Start <code class="bg-muted px-1 rounded text-primary">clamav-daemon</code> service</span>
              </li>
              <li class="flex gap-3 text-sm">
                <span class="flex-shrink-0 w-5 h-5 rounded-full bg-primary/10 text-primary text-[10px] font-bold flex items-center justify-center border border-primary/20">4</span>
                <span>Verify Host and Port settings</span>
              </li>
            </ul>
          </div>
        </div>
        <div class="card-footer bg-muted/20 border-t border-primary/10 pt-4 pb-4">
          <a href="https://www.clamav.net/documents/installing-clamav" target="_blank" class="text-xs font-bold text-primary hover:underline flex items-center gap-1">
            Official Documentation
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>
            </svg>
          </a>
        </div>
      </div>

      <!-- Quick Actions/Help -->
      <div class="card">
        <div class="card-content p-4 text-center">
          <p class="text-xs text-muted-foreground">Need help with complex scanner configurations?</p>
          <button class="btn-ghost btn-sm text-primary text-xs mt-2">Contact Support</button>
        </div>
      </div>
    </div>
  </div>
</div>


