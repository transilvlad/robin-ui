<div>
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-lg font-semibold">MTA-STS</h2>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-destructive mb-4">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
    <div>
      {{ error }}
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <mat-spinner diameter="36"></mat-spinner>
  </div>

  <div *ngIf="!loading" class="space-y-6">
    <!-- Current worker status -->
    <div class="card p-6">
      <h3 class="text-base font-semibold mb-6">Worker Status</h3>

      <div *ngIf="worker; else noWorker">
        <dl class="space-y-4">
          <div class="flex justify-between items-center pb-3 border-b border-border/50">
            <dt class="text-sm text-muted-foreground">Status</dt>
            <dd>
              <span class="badge" [ngClass]="getStatusClass(worker.status)">
                {{ worker.status }}
              </span>
            </dd>
          </div>
          <div class="flex justify-between items-center pb-3 border-b border-border/50">
            <dt class="text-sm text-muted-foreground">Worker Name</dt>
            <dd class="text-sm font-medium">{{ worker.workerName }}</dd>
          </div>
          <div class="flex justify-between items-center pb-3 border-b border-border/50">
            <dt class="text-sm text-muted-foreground">Worker ID</dt>
            <dd class="text-sm font-mono text-muted-foreground">{{ worker.workerId ?? '—' }}</dd>
          </div>
          <div class="flex justify-between items-center pb-3 border-b border-border/50">
            <dt class="text-sm text-muted-foreground">Policy Mode</dt>
            <dd class="text-sm font-bold uppercase tracking-tight">{{ worker.policyMode }}</dd>
          </div>
          <div class="flex justify-between items-center pb-3 border-b border-border/50">
            <dt class="text-sm text-muted-foreground">Policy Version</dt>
            <dd class="text-sm text-muted-foreground font-mono">{{ worker.policyVersion ?? '—' }}</dd>
          </div>
          <div class="flex justify-between items-center">
            <dt class="text-sm text-muted-foreground">Deployed At</dt>
            <dd class="text-sm font-medium">
              {{ worker.deployedAt ? (worker.deployedAt | date:'medium') : '—' }}
            </dd>
          </div>
        </dl>
      </div>

      <ng-template #noWorker>
        <div class="flex flex-col items-center justify-center py-8 text-center bg-muted/30 rounded-lg border border-dashed border-border">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-muted-foreground mb-3 opacity-50"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path></svg>
          <p class="text-sm text-muted-foreground max-w-xs">
            No MTA-STS worker deployed. Configure a policy mode and click Deploy.
          </p>
        </div>
      </ng-template>
    </div>

    <!-- Policy mode configuration -->
    <div class="card p-6">
      <h3 class="text-base font-semibold mb-6">Policy Configuration</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div
          *ngFor="let mode of policyModes"
          (click)="selectedPolicyMode = mode.value"
          class="flex flex-col gap-2 p-4 rounded-lg border cursor-pointer transition-all"
          [class.border-primary]="selectedPolicyMode === mode.value"
          [class.bg-primary/5]="selectedPolicyMode === mode.value"
          [class.border-border]="selectedPolicyMode !== mode.value"
          [class.hover:border-border/80]="selectedPolicyMode !== mode.value">
          <div class="flex justify-between items-start">
            <p class="text-sm font-bold uppercase tracking-tight">{{ mode.label }}</p>
            <div class="w-4 h-4 rounded-full border-2"
                 [class.border-primary]="selectedPolicyMode === mode.value"
                 [class.bg-primary]="selectedPolicyMode === mode.value"
                 [class.border-muted]="selectedPolicyMode !== mode.value"></div>
          </div>
          <p class="text-xs text-muted-foreground leading-relaxed">{{ mode.description }}</p>
        </div>
      </div>

      <div class="flex gap-3">
        <button
          *ngIf="worker"
          (click)="updatePolicy()"
          class="btn-outline btn-md">
          Update Policy
        </button>
        <button
          (click)="deploy()"
          [disabled]="deploying"
          class="btn-primary btn-md">
          <svg *ngIf="!deploying" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="m12 14 4-4-4-4"></path><path d="M3 3.41V9h5.59"></path><path d="M16 14.59V9h-5.59"></path><path d="M21 20.59V15h-5.59"></path><path d="M16 20.59H3a2 2 0 0 1-2-2v-11a2 2 0 0 1 2-2h4"></path></svg>
          {{ deploying ? 'Deploying...' : (worker ? 'Re-deploy' : 'Deploy') }}
        </button>
      </div>
    </div>
  </div>
</div>
