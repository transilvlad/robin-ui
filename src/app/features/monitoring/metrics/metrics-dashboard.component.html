<div class="p-10 min-h-screen bg-background">
  <div class="max-w-[1400px] mx-auto space-y-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
      <div>
        <h1 class="text-3xl font-bold tracking-tight text-foreground">Metrics Dashboard</h1>
        <p class="text-muted-foreground mt-1">Real-time system health and message queue performance</p>
      </div>

      <div class="flex items-center gap-3">
        <div class="flex items-center bg-muted/20 border border-border rounded-lg p-1 mr-2">
          <select [(ngModel)]="selectedTimeRange" (change)="onTimeRangeChange()" class="btn-ghost btn-sm text-[10px] font-bold uppercase tracking-widest bg-transparent border-none cursor-pointer">
            @for (range of timeRanges; track range) {
              <option [value]="range">{{ timeRangeLabels[range] }}</option>
            }
          </select>
        </div>

        <button 
          (click)="toggleAutoRefresh()" 
          [class]="'btn-sm flex items-center gap-2 px-4 transition-all ' + (autoRefresh ? 'btn-primary shadow-lg shadow-primary/20' : 'btn-outline')"
        >
          @if (autoRefresh) {
            <svg class="animate-spin h-3.5 w-3.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Live Updates
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 15 15 20 20 15"/><path d="M4 4V9H9"/><path d="M20 20V15H15"/><path d="M4 9A9 9 0 0 1 15 4"/><path d="M20 15A9 9 0 0 1 9 20"/>
            </svg>
            Updates Paused
          }
        </button>

        <button (click)="refreshMetrics()" class="btn-outline btn-icon h-9 w-9" title="Refresh Now">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/>
          </svg>
        </button>

        <button (click)="exportMetrics()" class="btn-outline btn-sm flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
          Export
        </button>
      </div>
    </div>

    <!-- System Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      @if (systemStats) {
        <!-- CPU -->
        <div class="card p-6 flex flex-col space-y-2 border-l-4 border-l-destructive">
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold uppercase tracking-widest text-muted-foreground">CPU Load</span>
            <div class="p-1.5 rounded bg-destructive/10 text-destructive">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="4" y="4" width="16" height="16" rx="2"/><path d="M9 4v16"/><path d="M15 4v16"/><path d="M4 9h16"/><path d="M4 15h16"/>
              </svg>
            </div>
          </div>
          <div class="text-3xl font-extrabold text-foreground">{{ (systemStats.cpu.usage || 0).toFixed(1) }}%</div>
          <div class="text-[10px] font-bold text-muted-foreground uppercase">{{ systemStats.cpu.cores || systemStats.cpu.processors || 0 }} Processing Units</div>
        </div>

        <!-- Memory -->
        <div class="card p-6 flex flex-col space-y-2 border-l-4 border-l-primary">
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold uppercase tracking-widest text-muted-foreground">Memory</span>
            <div class="p-1.5 rounded bg-primary/10 text-primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 19v-3"/><path d="M10 19v-3"/><path d="M14 19v-3"/><path d="M18 19v-3"/><path d="M8 11V9"/><path d="M16 11V9"/><path d="M12 11V9"/><path d="M2 15h20"/><path d="M2 7h20"/><path d="M2 5h20"/><path d="M2 17h20"/><path d="M2 19h20"/>
              </svg>
            </div>
          </div>
          <div class="text-3xl font-extrabold text-foreground">{{ (systemStats.memory.usagePercent || 0).toFixed(1) }}%</div>
          <div class="text-[10px] font-bold text-muted-foreground uppercase">
            {{ formatBytes(systemStats.memory.used) }} / {{ formatBytes(systemStats.memory.total) }}
          </div>
        </div>

        <!-- Storage -->
        <div class="card p-6 flex flex-col space-y-2 border-l-4 border-l-orange-500">
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold uppercase tracking-widest text-muted-foreground">Storage</span>
            <div class="p-1.5 rounded bg-orange-500/10 text-orange-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v5"/><path d="M3 12v5a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-5"/><path d="M3 12h18"/><path d="M16 8h2"/><path d="M16 16h2"/>
              </svg>
            </div>
          </div>
          <div class="text-3xl font-extrabold text-foreground">{{ (systemStats.disk?.usagePercent || 0).toFixed(1) }}%</div>
          <div class="text-[10px] font-bold text-muted-foreground uppercase">
            @if (systemStats.disk) {
              {{ formatBytes(systemStats.disk.used) }} / {{ formatBytes(systemStats.disk.total) }}
            } @else {
              Data Not Available
            }
          </div>
        </div>

        <!-- Uptime -->
        <div class="card p-6 flex flex-col space-y-2 border-l-4 border-l-accent">
          <div class="flex items-center justify-between">
            <span class="text-xs font-bold uppercase tracking-widest text-muted-foreground">Uptime</span>
            <div class="p-1.5 rounded bg-accent/10 text-accent">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
              </svg>
            </div>
          </div>
          <div class="text-2xl font-extrabold text-foreground pt-1">{{ formatUptime(systemStats.uptime) }}</div>
          <div class="text-[10px] font-bold text-accent uppercase tracking-tighter">System Online</div>
        </div>
      } @else {
        @for (i of [1,2,3,4]; track i) {
          <div class="card p-6 h-32 flex flex-col space-y-4">
            <div class="skeleton h-4 w-24"></div>
            <div class="skeleton h-10 w-32"></div>
            <div class="skeleton h-3 w-40"></div>
          </div>
        }
      }
    </div>

    <!-- Queue Performance -->
    <div class="space-y-4">
      <div class="flex items-center gap-3">
        <h3 class="text-xs font-bold uppercase tracking-[0.2em] text-muted-foreground">Queue Performance</h3>
        <div class="h-[1px] flex-1 bg-border/60"></div>
      </div>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
        @if (queueStats) {
          <!-- Size -->
          <div class="card p-4 bg-muted/20 border-none shadow-none">
            <div class="text-[10px] font-bold text-muted-foreground uppercase mb-1">Queue Size</div>
            <div class="text-2xl font-extrabold text-blue-600">{{ queueStats.queueSize }}</div>
          </div>
          <!-- Processing -->
          <div class="card p-4 bg-muted/20 border-none shadow-none">
            <div class="text-[10px] font-bold text-muted-foreground uppercase mb-1">In Flight</div>
            <div class="text-2xl font-extrabold text-orange-500">{{ queueStats.processing }}</div>
          </div>
          <!-- Failed -->
          <div class="card p-4 bg-muted/20 border-none shadow-none">
            <div class="text-[10px] font-bold text-muted-foreground uppercase mb-1">Failures</div>
            <div class="text-2xl font-extrabold text-destructive">{{ queueStats.failed }}</div>
          </div>
          <!-- Completed -->
          <div class="card p-4 bg-muted/20 border-none shadow-none">
            <div class="text-[10px] font-bold text-muted-foreground uppercase mb-1">Delivered</div>
            <div class="text-2xl font-extrabold text-accent">{{ queueStats.completed }}</div>
          </div>
          <!-- Throughput -->
          <div class="card p-4 bg-muted/20 border-none shadow-none">
            <div class="text-[10px] font-bold text-muted-foreground uppercase mb-1">Msg / Min</div>
            <div class="text-2xl font-extrabold text-primary">
              {{ queueStats.throughput ? queueStats.throughput.toFixed(1) : '0.0' }}
            </div>
          </div>
        } @else {
          @for (i of [1,2,3,4,5]; track i) {
            <div class="skeleton h-20 w-full rounded-xl"></div>
          }
        }
      </div>
    </div>

    <!-- Charts Section -->
    <div class="space-y-6">
      @if (loading) {
        <div class="flex flex-col items-center justify-center py-24 space-y-4">
          <svg class="animate-spin h-10 w-10 text-primary opacity-20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <p class="text-sm font-bold uppercase tracking-widest text-muted-foreground">Aggregating telemetry data...</p>
        </div>
      }

      <div [class]="'grid grid-cols-1 lg:grid-cols-2 gap-8 transition-opacity duration-500 ' + (loading ? 'opacity-0' : 'opacity-100')">
        <!-- Queue Size Chart -->
        <div class="card p-6 shadow-xl shadow-blue-500/[0.03]">
          <div class="chart-container">
            <canvas #queueChart></canvas>
          </div>
        </div>

        <!-- Messages Chart -->
        <div class="card p-6 shadow-xl shadow-green-500/[0.03]">
          <div class="chart-container">
            <canvas #messagesChart></canvas>
          </div>
        </div>

        <!-- Connections Chart -->
        <div class="card p-6 shadow-xl shadow-orange-500/[0.03]">
          <div class="chart-container">
            <canvas #connectionsChart></canvas>
          </div>
        </div>

        <!-- CPU Chart -->
        <div class="card p-6 shadow-xl shadow-red-500/[0.03]">
          <div class="chart-container">
            <canvas #cpuChart></canvas>
          </div>
        </div>

        <!-- Memory Chart -->
        <div class="card p-6 lg:col-span-2 shadow-xl shadow-primary/[0.03]">
          <div class="chart-container">
            <canvas #memoryChart></canvas>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      @if (!loading && !metricsData) {
        <div class="flex flex-col items-center justify-center py-24 text-center">
          <div class="p-6 rounded-full bg-muted/50 text-muted-foreground/30 mb-6 border border-border">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-foreground">No telemetry available</h3>
          <p class="text-muted-foreground text-sm max-w-sm mt-2">Could not retrieve metrics data for the selected period. Please verify server connectivity.</p>
          <button (click)="refreshMetrics()" class="btn-primary mt-6 px-8">Reload Data</button>
        </div>
      }
    </div>
  </div>
</div>

